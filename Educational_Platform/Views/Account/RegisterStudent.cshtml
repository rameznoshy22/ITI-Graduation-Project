@using Educational_Platform.ViewModel

@model RegisterStudentViewModel

@{
    ViewData["Title"] = "Student Registration";
    @Html.Partial("~/Views/Shared/Styling.cshtml")

    Layout = "_AuthLayout";
}

<style>
    .fo {
        font-family: "Cairo", sans-serif;
    }

</style>
<div class="container py-5" dir="rtl">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            

            <div class="card shadow-lg border-0 rounded-lg">
                <div class="  btn-primary text-white py-3">
                    <h3 class="mb-0 text-center fo"><i class="fa fa-user-plus me-2 "></i>  انضم إلى منصة مفهوم</h3>

                </div>

                <div class="card-body p-4 p-lg-5">
                    <form id="registrationForm" asp-action="RegisterStudent" method="post" enctype="multipart/form-data">
                        @if (ViewData.ModelState.IsValid == false)
                        {
                            <div asp-validation-summary="All" class="text-danger mb-4 alert alert-danger py-2" id="validationSummary"></div>
                        }
                        <!-- المعلومات الشخصية -->
                        <div class="registration-section mb-4">
                            <div class="d-flex align-items-center mb-3">
                                <div class="section-icon rounded-circle bg-primary text-white d-flex align-items-center justify-content-center ms-3" style="width: 32px; height: 32px;">
                                    <i class="fa fa-shield-alt"></i>
                                </div>
                                <h5 class="mb-0 border-bottom pb-2 w-100 fo">المعلومات الشخصية</h5>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="FirstName" class="form-label fw-semibold"><i class="fa fa-user me-1"></i> الاسم الأول</label>
                                    <input asp-for="FirstName" class="form-control form-control-lg" placeholder="أدخل الاسم الأول" data-field="required" />
                                    <span asp-validation-for="FirstName" class="text-danger"></span>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label asp-for="LastName" class="form-label fw-semibold"><i class="fa fa-user me-1"></i> اسم العائلة</label>
                                    <input asp-for="LastName" class="form-control form-control-lg" placeholder="أدخل اسم العائلة" data-field="required" />
                                    <span asp-validation-for="LastName" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- معلومات التواصل -->
                        <div class="registration-section mb-4">
                            <div class="d-flex align-items-center mb-3">
                                <div class="section-icon rounded-circle bg-primary text-white d-flex align-items-center justify-content-center ms-3" style="width: 32px; height: 32px;">
                                    <i class="fa fa-shield-alt"></i>
                                </div>
                                <h5 class="mb-0 border-bottom pb-2 w-100 fo">معلومات التواصل</h5>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Email" class="form-label fw-semibold"><i class="fa fa-envelope me-1"></i> البريد الإلكتروني</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fa fa-envelope"></i></span>
                                    <input asp-for="Email" class="form-control form-control-lg" placeholder="name@example.com" autocomplete="email" data-field="required" />
                                </div>
                                <span asp-validation-for="Email" class="text-danger"></span>
                                <small class="form-text text-muted">سوف نرسل رابط التحقق إلى هذا البريد</small>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="PhoneNumber" class="form-label fw-semibold"><i class="fa fa-phone me-1"></i> رقم الهاتف</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light">+20</span>
                                        <input asp-for="PhoneNumber" class="form-control form-control-lg" placeholder="1XXXXXXXXX" data-field="required" />
                                    </div>
                                    <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label asp-for="FatherPhoneNumber" class="form-label fw-semibold"><i class="fa fa-phone me-1"></i> رقم ولي الأمر</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light">+20</span>
                                        <input asp-for="FatherPhoneNumber" class="form-control form-control-lg" placeholder="1XXXXXXXXX" data-field="required" />
                                    </div>
                                    <span asp-validation-for="FatherPhoneNumber" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        <!-- قسم المعلومات الأكاديمية -->
                        <div class="registration-section mb-4" dir="rtl">
                            <div class="d-flex align-items-center mb-3">
                                <div class="section-icon rounded-circle bg-primary text-white d-flex align-items-center justify-content-center ms-3" style="width: 32px; height: 32px;">
                                    <i class="fa fa-graduation-cap"></i>
                                </div>
                                <h5 class="mb-0 border-bottom pb-2 w-100 fo">المعلومات الأكاديمية</h5>
                            </div>

                            <div class="mb-3">
                                <label asp-for="GradeLevel" class="form-label fw-semibold">
                                    <i class="fa fa-graduation-cap ms-1"></i> المرحلة الدراسية
                                </label>
                                <select asp-for="GradeLevel" class="form-select form-select-lg" data-field="required">
                                    <option value="" selected disabled>اختر المرحلة الدراسية</option>

                                    <optgroup label="المرحلة الثانوية">
                                        <option value="الصف الأول الثانوي">الصف الأول الثانوي</option>
                                        <option value="الصف الثاني الثانوي">الصف الثاني الثانوي</option>
                                        <option value="الصف الثالث الثانوي">الصف الثالث الثانوي</option>
                                    </optgroup>
                                </select>
                                <span asp-validation-for="GradeLevel" class="text-danger"></span>
                                <small class="form-text text-muted">سيساعدنا هذا في ترشيح الدورات المناسبة لك</small>
                            </div>
                        </div>

                        <!-- قسم الملف الشخصي والأمان -->
                        <div class="registration-section mb-4" dir="rtl">
                            <div class="d-flex align-items-center mb-3">
                                <div class="section-icon rounded-circle bg-primary text-white d-flex align-items-center justify-content-center ms-3" style="width: 32px; height: 32px;">
                                    <i class="fa fa-shield-alt"></i>
                                </div>
                                <h5 class="mb-0 border-bottom pb-2 w-100 fo">الملف الشخصي والأمان</h5>
                            </div>

                            <div class="mb-4">
                                <label asp-for="ProfilePicture" class="form-label fw-semibold">
                                    <i class="fa fa-image ms-1"></i> صورة الملف الشخصي
                                </label>
                                <div class="text-center mb-3">
                                    <img id="imagePreview" src="~/img/avatar.png" class="rounded-circle img-thumbnail" style="width: 150px; height: 150px; object-fit: cover;" />
                                </div>
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fa fa-upload"></i></span>
                                    <input asp-for="ProfilePictureFile" type="file" class="form-control" accept="image/*" onchange="previewImage(this)" />
                                </div>
                                <small class="form-text text-muted">قم برفع صورة للملف الشخصي (JPEG أو PNG، بحد أقصى 2 ميجابايت)</small>
                            </div>
                        </div>
                        <!-- قسم كلمة السر ن -->

                        <div class="mb-3" dir="rtl">
                            <label asp-for="Password" class="form-label fw-semibold"><i class="fa fa-lock ms-1"></i> كلمة المرور</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light"><i class="fa fa-lock"></i></span>
                                <input asp-for="Password" class="form-control form-control-lg" type="password" placeholder="أنشئ كلمة مرور قوية" data-field="required" />
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('Password')"><i class="fa fa-eye"></i></button>
                            </div>
                            <span asp-validation-for="Password" class="text-danger"></span>
                            <div class="mt-2">
                                <div class="password-strength-meter progress" style="height: 8px;">
                                    <div id="passwordStrength" class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small id="passwordStrengthText" class="form-text">قوة كلمة المرور: ضعيفة جدًا</small>
                            </div>
                        </div>

                        <div class="mb-4" dir="rtl">
                            <label asp-for="ConfirmPassword" class="form-label fw-semibold"><i class="fa fa-lock ms-1"></i> تأكيد كلمة المرور</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light"><i class="fa fa-lock"></i></span>
                                <input asp-for="ConfirmPassword" class="form-control form-control-lg" type="password" placeholder="أكد كلمة المرور الخاصة بك" data-field="required" />
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('ConfirmPassword')"><i class="fa fa-eye"></i></button>
                            </div>
                            <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                        </div>



                        <div class="mb-4" dir="rtl">
                            <div class="form-check" style="display: flex; align-items: center; gap: 8px;">
                                <input class="form-check-input m-0" type="checkbox" id="termsCheck" required
                                       style="flex-shrink: 0; width: 1.2em; height: 1.2em;">
                                <label class="form-check-label" for="termsCheck" style="line-height: 1.5;">
                                    أوافق على <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">الشروط والأحكام</a> و
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">سياسة الخصوصية</a>
                                </label>
                            </div>
                        </div>

                        <div class="d-grid gap-2" dir="rtl">
                            <button type="submit" class="btn btn-primary btn-lg py-3 fo">
                                <i class="fa fa-user-plus ms-2"></i>إنشاء حساب طالب
                            </button>
                        </div>


                    </form>
                </div>
                <div class="card-footer bg-light py-3 text-center " dir="rtl">
                    <div class="d-flex justify-content-center align-items-center flex-wrap gap-3 ">
                        <span>لديك حساب بالفعل؟</span>
                        <a asp-action="Login" asp-controller="Account" class="btn btn-outline-primary fo">
                            <i class="fa fa-sign-in-alt ms-2"></i>تسجيل الدخول
                        </a>
                    </div>
                </div>

            </div>

            <div class="text-center mt-3" dir="rtl">
                <p class="small text-muted">هل تحتاج إلى مساعدة؟ <a href="#" class="text-decoration-none">اتصل بالدعم الفني</a></p>
            </div>


        </div>
    </div>
</div>

<!-- شروط الاستخدام -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true" dir="rtl">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title" id="termsModalLabel">شروط الاستخدام</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <h6>١. المقدمة</h6>
                <p>من خلال تسجيلك في الموقع، فإنك توافق على الالتزام بهذه الشروط والأحكام.</p>

                <h6>٢. التسجيل وحماية الحساب</h6>
                <p>أنت مسؤول عن الحفاظ على سرية حسابك وكلمة المرور الخاصة بك، وتتحمل كامل المسؤولية عن جميع الأنشطة التي تتم باستخدام حسابك.</p>

                <h6>٣. المحتوى التعليمي</h6>
                <p>جميع المحتويات المقدمة هي لأغراض تعليمية فقط. وتتعهد بعدم نسخها أو توزيعها أو إعادة استخدامها دون إذن.</p>

                <h6>٤. قواعد السلوك</h6>
                <p>تتعهد باستخدام المنصة بطريقة محترمة وبنّاءة، وتجنب أي نشاط مسيء أو ضار.</p>
            </div>
            <div class="mb-4" dir="rtl">
                <div class="form-check" style="display: flex; align-items: center; gap: 8px;">
                    <input class="form-check-input m-0" type="checkbox" id="termsCheck" required
                           style="flex-shrink: 0; width: 1.2em; height: 1.2em;">
                    <label class="form-check-label" for="termsCheck" style="line-height: 1.5;">
                        أوافق على <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">الشروط والأحكام</a> و
                        <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">سياسة الخصوصية</a>
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- سياسة الخصوصية -->
<div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true" dir="rtl">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title" id="privacyModalLabel">سياسة الخصوصية</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <h6>١. جمع المعلومات</h6>
                <p>نقوم بجمع معلومات شخصية مثل الاسم، والبريد الإلكتروني، وبيانات الاتصال لتقديم خدمات تعليمية.</p>

                <h6>٢. كيفية استخدام المعلومات</h6>
                <p>تُستخدم معلوماتك لإدارة حسابك وتوفير الوصول إلى الدورات وتحسين خدماتنا التعليمية.</p>

                <h6>٣. أمان المعلومات</h6>
                <p>نستخدم تدابير أمنية مناسبة لحماية معلوماتك الشخصية من الوصول أو الكشف غير المصرح به.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function() {
            // Auto-focus on first name field
            $("#FirstName").focus();

            // Update progress bar as user completes fields
            updateProgressBar();
            $('[data-field="required"]').on('change keyup', function() {
                updateProgressBar();
            });

            // Password strength meter
            $('#Password').on('keyup', function() {
                checkPasswordStrength($(this).val());
            });

            // Show validation summary if there are any
            if ($('#validationSummary ul li').length > 0) {
                $('#validationSummary').show();
            }
        });

        function updateProgressBar() {
            const requiredFields = $('[data-field="required"]').length;
            const filledFields = $('[data-field="required"]').filter(function() {
                return $(this).val() !== "";
            }).length;

            const percentage = Math.round((filledFields / requiredFields) * 100);
            $('#progressBar').css('width', percentage + '%');
            $('#completionPercentage').text(percentage);

            // Update progress bar color based on completion
            if (percentage < 30) {
                $('#progressBar').removeClass('bg-warning bg-success').addClass('bg-danger');
            } else if (percentage < 70) {
                $('#progressBar').removeClass('bg-danger bg-success').addClass('bg-warning');
            } else {
                $('#progressBar').removeClass('bg-danger bg-warning').addClass('bg-success');
            }
        }

        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    $('#imagePreview').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function togglePassword(fieldId) {
            const passwordField = document.getElementById(fieldId);
            const fieldType = passwordField.getAttribute('type');

            if (fieldType === 'password') {
                passwordField.setAttribute('type', 'text');
                $(event.target).removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                passwordField.setAttribute('type', 'password');
                $(event.target).removeClass('fa-eye-slash').addClass('fa-eye');
            }
        }
                $('#registrationForm').on('submit', function (e) {
            const isChecked = $('#termsCheck').is(':checked');
            if (!isChecked) {
               
                e.preventDefault();
            } 
        });

        function checkPasswordStrength(password) {
            // Password strength logic
            let strength = 0;

            if (password.length >= 6) strength += 20;
            if (password.length >= 8) strength += 10;
            if (/[A-Z]/.test(password)) strength += 20;
            if (/[a-z]/.test(password)) strength += 20;
            if (/[0-9]/.test(password)) strength += 20;
            if (/[^A-Za-z0-9]/.test(password)) strength += 10;

            // Update the UI
            $('#passwordStrength').css('width', strength + '%');

            if (strength < 40) {
                $('#passwordStrength').removeClass('bg-warning bg-success').addClass('bg-danger');
                $('#passwordStrengthText').text('Password strength: Weak');
            } else if (strength < 70) {
                $('#passwordStrength').removeClass('bg-danger bg-success').addClass('bg-warning');
                $('#passwordStrengthText').text('Password strength: Moderate');
            } else {
                $('#passwordStrength').removeClass('bg-danger bg-warning').addClass('bg-success');
                $('#passwordStrengthText').text('Password strength: Strong');
            }
        }
    </script>
}
